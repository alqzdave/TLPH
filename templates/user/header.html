<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<header class="bg-green-700 text-white shadow-md sticky top-0 z-[1050]">
    <nav class="container mx-auto px-4 py-2 flex justify-between items-center relative">
        
        <div class="flex items-center gap-2 group cursor-pointer" onclick="window.location.href='/user/dashboard'">
            <img src="{{ url_for('static', filename='images/denr.jpg') }}" 
                alt="DENR Logo" 
                class="h-8 w-8 md:h-9 md:w-9 object-contain bg-white rounded-full p-0.5 shadow-sm transition-transform group-hover:scale-105">
            <div class="flex flex-col leading-none">
                <h1 class="text-white text-lg md:text-xl font-bold tracking-tight uppercase">DENR</h1>
                <span class="hidden sm:block text-[7px] md:text-[8px] text-green-200 font-medium tracking-widest uppercase italic">
                    Department of Environment and Natural Resources
                </span>
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
            
            <div class="hidden lg:flex items-center gap-1 border-r border-green-600/50 pr-4">
                <a href="/user/dashboard" class="px-2 py-1.5 rounded text-white hover:bg-green-800 font-medium no-underline text-[13px] transition-colors">Home</a>
                <a href="/user/application" class="px-2 py-1.5 rounded text-white hover:bg-green-800 font-medium no-underline text-[13px] transition-colors">Application</a>
                <a href="/user/license/license" class="px-2 py-1.5 rounded text-white hover:bg-green-800 font-medium no-underline text-[13px] transition-colors">License/Permit</a>
                <a href="/user/service/service" class="px-2 py-1.5 rounded text-white hover:bg-green-800 font-medium no-underline text-[13px] transition-colors">Service</a>
                <a href="/user/inventory" class="px-2 py-1.5 rounded text-white hover:bg-green-800 font-medium no-underline text-[13px] transition-colors">Inventory</a>
                <a href="/user/history" class="px-2 py-1.5 rounded text-white hover:bg-green-800 font-medium no-underline text-[13px] transition-colors">History</a>
            </div>

            <div class="dropdown">
                <button class="flex items-center gap-2 bg-green-800/40 hover:bg-green-800 px-2 py-1 rounded-full border border-white/20 transition-all focus:outline-none" 
                        type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="https://ui-avatars.com/api/?name=User&background=fff&color=15803d&bold=true" 
                         alt="User" 
                         class="h-7 w-7 rounded-full border border-white/40">
                    <i class="fa-solid fa-chevron-down text-[9px] text-green-200"></i>
                </button> 
                
                <ul class="dropdown-menu dropdown-menu-end shadow-xl border-0 mt-2 rounded-lg p-1 animate-fade-in" aria-labelledby="profileDropdown">
                    <li class="px-2 py-1 mb-1 border-b border-gray-100">
                        <p class="text-[9px] font-black text-gray-400 uppercase tracking-widest">Account Settings</p>
                    </li>
                    <li><a class="dropdown-item rounded py-2 flex items-center gap-3 text-gray-700" href="/user/profile"><i class="fa-solid fa-user-gear text-green-700 w-4"></i><span class="text-[13px] font-bold">Profile Info</span></a></li>
                    <li><a class="dropdown-item rounded py-2 flex items-center gap-3 text-blue-600" href="/user/transaction"><i class="fa-solid fa-receipt text-blue-600 w-4"></i><span class="text-[13px] font-bold">Transactions</span></a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item rounded py-2 flex items-center gap-3 text-red-600" href="/"><i class="fa-solid fa-right-from-bracket text-red-600 w-4"></i><span class="text-[13px] font-bold">Logout</span></a></li>
                </ul>
            </div>

            <button class="lg:hidden text-white p-2 focus:outline-none hover:bg-green-800 rounded-lg transition-colors relative z-[110]" 
                    type="button" 
                    id="mobileMenuBtn"
                    data-bs-toggle="collapse" 
                    data-bs-target="#mobileMenu" 
                    aria-expanded="false">
                <i class="fa-solid fa-bars-staggered text-xl"></i>
            </button>
        </div>

        <div class="collapse absolute top-full left-0 w-full bg-green-800 shadow-2xl border-t border-green-600 lg:hidden z-[1000]" id="mobileMenu">
            <div class="flex flex-col p-4 space-y-1">
                <a href="/user/dashboard" class="px-4 py-3 rounded-lg text-white hover:bg-green-700 no-underline text-sm font-bold flex items-center gap-4 transition-all">
                    <i class="fa-solid fa-house w-5 text-green-300"></i> Home
                </a>
                <a href="/user/application" class="px-4 py-3 rounded-lg text-white hover:bg-green-700 no-underline text-sm font-bold flex items-center gap-4 transition-all">
                    <i class="fa-solid fa-file-lines w-5 text-green-300"></i> Application
                </a>
                <a href="/user/license/license" class="px-4 py-3 rounded-lg text-white hover:bg-green-700 no-underline text-sm font-bold flex items-center gap-4 transition-all">
                    <i class="fa-solid fa-id-card w-5 text-green-300"></i> License/Permit
                </a>
                <a href="/user/service/service" class="px-4 py-3 rounded-lg text-white hover:bg-green-700 no-underline text-sm font-bold flex items-center gap-4 transition-all">
                    <i class="fa-solid fa-handshake w-5 text-green-300"></i> Service
                </a>
                <a href="/user/inventory" class="px-4 py-3 rounded-lg text-white hover:bg-green-700 no-underline text-sm font-bold flex items-center gap-4 transition-all">
                    <i class="fa-solid fa-boxes-stacked w-5 text-green-300"></i> Inventory
                </a>
                <a href="/user/history" class="px-4 py-3 rounded-lg text-white hover:bg-green-700 no-underline text-sm font-bold flex items-center gap-4 transition-all">
                    <i class="fa-solid fa-clock-rotate-left w-5 text-green-300"></i> History
                </a>
            </div>
        </div>
    </nav>
</header>

<style>
    .animate-fade-in { animation: fadeIn 0.2s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .dropdown-item:hover { background-color: #f0fdf4 !important; color: #15803d !important; }
    #mobileMenu.show { display: block !important; visibility: visible !important; opacity: 1 !important; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Fallback for Mobile Menu if Bootstrap JS is not loading correctly
        const menu = document.getElementById('mobileMenu');
        const btn = document.getElementById('mobileMenuBtn');

        if (btn && menu) {
            btn.addEventListener('click', function () {
                // If bootstrap is available, let it handle. If not, manual toggle.
                if (typeof bootstrap === 'undefined') {
                    menu.classList.toggle('show');
                }
            });
        }

        // Close menu when clicking outside
        document.addEventListener('click', function (event) {
            if (menu && menu.classList.contains('show') && !menu.contains(event.target) && !btn.contains(event.target)) {
                if (typeof bootstrap !== 'undefined') {
                    const bsCollapse = bootstrap.Collapse.getInstance(menu) || new bootstrap.Collapse(menu, {toggle: false});
                    bsCollapse.hide();
                } else {
                    menu.classList.remove('show');
                }
            }
        });
    });
</script>