<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DENR | Super Admin Console</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            denr: '#006400',
            'denr-light': '#f0fdf4',
          }
        }
      }
    }
  </script>
</head>

<body class="min-h-screen bg-slate-50 font-sans text-slate-900">
    {% include 'super-admin/header-superadmin.html' %}
    {% include 'super-admin/sidenav-superadmin.html' %}

  <div class="max-w-[1750px] mx-auto p-4 lg:p-6 space-y-6"> 
    
    <header class="bg-white border border-slate-300 border-t-4 border-t-denr rounded-lg p-4 flex items-center gap-6 shadow-sm">
      <img src="https://upload.wikimedia.org/wikipedia/commons/f/f3/Seal_of_the_Department_of_Environment_and_Natural_Resources.png" class="h-12 w-12" alt="DENR Seal">
      <div class="flex-1">
        <h1 class="font-serif text-xl font-black">Super Admin Master Control</h1>
        <p class="text-[9px] font-bold text-green-700 uppercase tracking-widest">2026 Nationwide Compliance & Resource Management</p>
      </div>
      <div class="flex gap-2">
          <button class="border border-slate-300 px-5 py-2 text-[10px] font-bold rounded hover:bg-slate-50 transition-colors uppercase">Export Logs</button>
          <button class="bg-denr text-white px-5 py-2 text-[10px] font-bold rounded shadow hover:opacity-90 uppercase">System Sync</button>
      </div>
    </header>

    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
        <div class="bg-white border border-slate-300 border-t-4 border-t-green-800 rounded-lg p-3">
          <p class="text-[9px] font-bold text-slate-400 uppercase">Applications</p>
          <h3 class="text-xl font-black" id="kpi-apps">0</h3>
        </div>
        <div class="bg-white border border-slate-300 border-t-4 border-t-blue-700 rounded-lg p-3">
          <p class="text-[9px] font-bold text-slate-400 uppercase">Requests</p>
          <h3 class="text-xl font-black" id="kpi-reqs">0</h3>
        </div>
        <div class="bg-white border border-slate-300 border-t-4 border-t-amber-500 rounded-lg p-3">
          <p class="text-[9px] font-bold text-slate-400 uppercase">Permits</p>
          <h3 class="text-xl font-black" id="kpi-permits">0</h3>
        </div>
        <div class="bg-white border border-slate-300 border-t-4 border-t-emerald-600 rounded-lg p-3">
          <p class="text-[9px] font-bold text-slate-400 uppercase">Inventory</p>
          <h3 class="text-xl font-black" id="kpi-inv">0</h3>
        </div>
        <div class="bg-white border border-slate-300 border-t-4 border-t-indigo-600 rounded-lg p-3">
          <p class="text-[9px] font-bold text-slate-400 uppercase">User Assets</p>
          <h3 class="text-xl font-black" id="kpi-uinv">0</h3>
        </div>
        <div class="bg-white border border-slate-300 border-t-4 border-t-red-600 rounded-lg p-3">
          <p class="text-[9px] font-bold text-slate-400 uppercase">Transactions</p>
          <h3 class="text-xl font-black" id="kpi-txn">0</h3>
        </div>
        <div class="bg-white border border-slate-300 border-t-4 border-t-black rounded-lg p-3">
          <p class="text-[9px] font-bold text-slate-400 uppercase">Users</p>
          <h3 class="text-xl font-black" id="kpi-users">0</h3>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 bg-white border border-slate-300 border-t-4 border-t-denr rounded-lg p-5 shadow-sm">
            <h4 class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-wider">7-Day Submission Volume</h4>
            <div class="h-[200px]">
                <canvas id="lineChart"></canvas>
            </div>
        </div>
        <div class="bg-white border border-slate-300 border-t-4 border-t-denr rounded-lg p-5 shadow-sm">
            <h4 class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-wider">Category Distribution</h4>
            <div class="h-[200px]">
                <canvas id="doughnutChart"></canvas>
            </div>
        </div>
    </div>

    <div class="bg-white border border-slate-300 border-t-4 border-t-denr rounded-lg shadow-sm flex flex-col min-h-[600px] overflow-hidden">
        
        <div class="p-4 bg-slate-50 border-b grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="text-[9px] font-black text-slate-500 uppercase">Global Search</label>
                <input id="searchInput" class="w-full px-3 py-2 text-xs border border-slate-300 rounded outline-none focus:ring-1 focus:ring-denr" placeholder="Search reference, name, or LGU...">
            </div>
            <div>
                <label class="text-[9px] font-black text-slate-500 uppercase">Category Filter</label>
                <select id="categorySelect" class="w-full px-3 py-2 text-xs border border-slate-300 rounded bg-white font-bold outline-none focus:ring-1 focus:ring-denr uppercase"></select>
            </div>
            <div class="flex items-end gap-2">
                <div class="flex-1">
                    <label class="text-[9px] font-black text-slate-500 uppercase">Scope</label>
                    <select id="scopeSelect" class="w-full px-3 py-2 text-xs border border-slate-300 rounded bg-white outline-none focus:ring-1 focus:ring-denr">
                        <option value="all">National</option>
                        <option value="ivb">Region IV-B</option>
                    </select>
                </div>
                <button class="bg-slate-800 text-white px-4 py-2 text-[10px] font-bold rounded hover:bg-black transition-colors">REFRESH</button>
            </div>
        </div>

        <nav class="flex bg-white border-b overflow-x-auto">
            <button class="nav-trigger active px-6 py-4 text-[10px] font-extrabold uppercase tracking-tight border-b-4 border-b-amber-500 bg-denr-light text-denr whitespace-nowrap" data-tab="applications">Applications</button>
            <button class="nav-trigger px-6 py-4 text-[10px] font-extrabold uppercase tracking-tight border-b-4 border-b-transparent text-slate-500 hover:text-denr whitespace-nowrap transition-all" data-tab="requests">Service Requests</button>
            <button class="nav-trigger px-6 py-4 text-[10px] font-extrabold uppercase tracking-tight border-b-4 border-b-transparent text-slate-500 hover:text-denr whitespace-nowrap transition-all" data-tab="inventory">Inventory</button>
            <button class="nav-trigger px-6 py-4 text-[10px] font-extrabold uppercase tracking-tight border-b-4 border-b-transparent text-slate-500 hover:text-denr whitespace-nowrap transition-all" data-tab="userInventory">User Inventory</button>
            <button class="nav-trigger px-6 py-4 text-[10px] font-extrabold uppercase tracking-tight border-b-4 border-b-transparent text-slate-500 hover:text-denr whitespace-nowrap transition-all" data-tab="permits">Licensing/Permits</button>
            <button class="nav-trigger px-6 py-4 text-[10px] font-extrabold uppercase tracking-tight border-b-4 border-b-transparent text-slate-500 hover:text-denr whitespace-nowrap transition-all" data-tab="transactions">Transactions</button>
            <button class="nav-trigger px-6 py-4 text-[10px] font-extrabold uppercase tracking-tight border-b-4 border-b-transparent text-slate-500 hover:text-denr whitespace-nowrap transition-all" data-tab="users">Users</button>
        </nav>

        <div class="overflow-x-auto flex-1">
            <table class="w-full text-left">
                <thead class="bg-slate-50 sticky top-0">
                  <tr id="tableHeadRow" class="text-[9px] uppercase font-black text-slate-400 border-b"></tr>
                </thead>
                <tbody id="tableBody" class="divide-y divide-slate-100 text-[11px] text-slate-600"></tbody>
            </table>
        </div>
        
        <div class="p-3 bg-slate-50 border-t flex justify-between items-center text-[10px] font-black text-slate-400 uppercase">
            <div>Result Count: <span id="resultCount" class="text-denr">0</span></div>
            <div>DENR-CO • Secure Super Admin Session • 2026</div>
        </div>
    </div>
  </div>

  <script>
    const CATEGORIES = {
      applications: ["Crop & Plant", "Livestock & Poultry", "Fisheries & Aquaculture", "Agribusiness & Agro-Processing", "Agricultural Trade (Import & Export)", "Land Use & Farm Development infrastructure", "Research, Technology & Innovation", "Farmer Support, Subsidies & Insurance", "Food Safety & Quality Regulation", "Extension Services & Capacity Building", "Climate Change, Disaster & Risk Management", "Data, Monitoring & Digital Agriculture", "Compliance, Inspection & Enforcement", "Institutional & Cooperative Development"],
      requests: ["initial farm visit", "compliance inspection", "disease/pest investigation", "agribusiness & agro-processing", "soil/crop evaluation", "follow up visit", "good agricultural practice(GAP) training", "pest & disease management seminar", "safe pesticide handling training", "nursery/propagation seminar", "regulatory compliance orientation", "input usage approval", "chemical registration/clearance", "fertilizer recommendation", "pesticide recommendation", "subsidy application", "grant assistance", "load endorsement", "crop insurance support", "startup/expansion support"],
      inventory: ["chemical inventory", "natural resources", "protected area", "biodiversity inventory"],
      userInventory: ["Field Electronics", "Safety Gear", "Vehicles", "Mobile Units"],
      permits: ["import permit", "Wildlife Trade Permit", "Transport Local Permit", "Harvest Permit", "Meat Transport / Shipping Permit", "Slaughterhouse Accreditation Permit", "Poultry Farm Registration", "Animal Health Veterinary Clearance", "Wildlife Possession & Ownership Permit", "Wildlife Transport Licensing Permit", "Wildlife Collection Licensing Permit", "Wildlife Farm & Breeding Registration", "Tree Cutting Permit", "Timber Wood / Transfer Permit", "Reforestation Agreement", "Nursery Accreditation", "Non-Timber Collection Permit", "Environment Compliance Certificate (ECC)", "Waste Management Permit", "Hazardous Material Handling Clearance", "Aquaculture Farm Registration", "Fish Transport Permit", "Fish Dealer / Trade License", "Collection / Harvest Permit", "Wastewater Discharge Permit (WWDP)", "Permit to Operate (PTO) Air Pollution", "Hazardous Waste Generator (HWG) ID", "PICCS validation", "PCL Compliance Certificate", "Chemical Control Orders (CCOs)", "Certificate of Tree Plantation Ownership (CTPO)"],
      transactions: ["Application Fee", "Permit Fee", "Inspection Fee"],
      users: ["National", "Regional", "Municipal"]
    };

    const DATA = {
      applications: [
          { date: "2026-02-12", ref: "APP-101", applicant: "Alqz Dave", category: "Fisheries & Aquaculture", region: "IV-B", municipality: "Calapan", status: "Pending" },
          { date: "2026-02-11", ref: "APP-102", applicant: "Juan Luna", category: "Crop & Plant", region: "IV-B", municipality: "Naujan", status: "Approved" }
      ],
      requests: [{ date: "2026-02-12", ref: "SR-990", applicant: "Maria Santos", category: "soil/crop evaluation", region: "IV-B", municipality: "Victoria", status: "To Review" }],
      inventory: [{ category: "natural resources", desc: "Nursery Propagules", qty: 1500, region: "IV-B", municipality: "Naujan" }],
      userInventory: [{ product: "Rugged Tablet", category: "Field Electronics", owner: "Cedric Admin", init: 10, curr: 7, region: "IV-B", municipality: "Calapan" }],
      permits: [{ ref: "PMT-882", applicant: "Nature Corp", category: "Wildlife Trade Permit", region: "IV-B", municipality: "Naujan", status: "Approved" }],
      transactions: [{ ref: "TXN-001", name: "Alqz Dave", type: "Permit Fee", date: "2026-02-12", region: "IV-B", municipality: "Calapan", status: "Paid", amount: 2500 }],
      users: [{ name: "Cedric Admin", email: "cedric@denr.gov.ph", type: "Regional", region: "IV-B", municipality: "Calapan", status: "Active" }]
    };

    const HEADERS = {
      applications: ["Date", "Reference & Applicant", "Category", "Region", "Municipality", "Status", "Actions"],
      requests: ["Date", "Reference & Applicant", "Category", "Region", "Municipality", "Status", "Actions"],
      inventory: ["Category", "Description", "Quantity", "Region", "Municipality", "Actions"],
      userInventory: ["Product Name", "Category", "Owner", "Initial Qty", "Current Qty", "Region", "Municipality", "Actions"],
      permits: ["Reference & Applicant", "Category", "Region", "Municipality", "Status", "Actions"],
      transactions: ["Reference Number", "Name", "Type", "Date", "Region", "Municipality", "Status", "Amount"],
      users: ["Name", "Email", "User Type", "Region", "Municipality", "Status", "Actions"]
    };

    let activeTab = "applications";
    const $ = (id) => document.getElementById(id);
    let myLineChart, myDoughnutChart;

    function populateCategories() {
      const select = $("categorySelect");
      select.innerHTML = '<option value="all">ALL CATEGORIES</option>';
      (CATEGORIES[activeTab] || []).forEach(cat => {
        const opt = document.createElement("option"); opt.value = cat; opt.textContent = cat.toUpperCase(); select.appendChild(opt);
      });
    }

    function renderTable() {
      const head = $("tableHeadRow"); const body = $("tableBody");
      const search = $("searchInput").value.toLowerCase();
      const catF = $("categorySelect").value;
      
      head.innerHTML = ""; body.innerHTML = "";
      HEADERS[activeTab].forEach(t => { const th = document.createElement("th"); th.className="px-6 py-4"; th.textContent = t; head.appendChild(th); });

      const filtered = DATA[activeTab].filter(r => {
        const mCat = catF === "all" || (Object.values(r).some(v => String(v).toLowerCase() === catF.toLowerCase()));
        const mSearch = Object.values(r).join(" ").toLowerCase().includes(search);
        return mCat && mSearch;
      });

      $("resultCount").textContent = filtered.length;

      filtered.forEach(r => {
        const tr = document.createElement("tr"); tr.className = "hover:bg-slate-50 transition-colors";
        const keys = Object.keys(r);
        keys.forEach(k => {
            const td = document.createElement("td"); td.className = "px-6 py-3 whitespace-nowrap";
            if (k === "ref" && (activeTab === "applications" || activeTab === "requests" || activeTab === "permits")) {
                td.innerHTML = `<div class="font-bold text-denr">${r.ref}</div><div class="text-[10px] font-medium text-slate-400">${r.applicant}</div>`;
            } 
            else if (k === "applicant" && (activeTab === "applications" || activeTab === "requests" || activeTab === "permits")) return;
            else if (k === "status") {
                const s = r[k].toLowerCase();
                const cls = (s==='approved'||s==='paid'||s==='active') ? 'bg-green-100 text-green-800 border-green-200' : 'bg-amber-100 text-amber-800 border-amber-200';
                td.innerHTML = `<span class="px-2 py-0.5 rounded border text-[9px] font-black uppercase ${cls}">${r[k]}</span>`;
            } 
            else if (k === "amount") td.textContent = "₱" + r[k].toLocaleString();
            else td.textContent = r[k];
            tr.appendChild(td);
        });

        const actionTd = document.createElement("td"); actionTd.className = "px-6 py-3 flex gap-1";
        const btnClass = "text-[9px] font-bold uppercase px-2 py-1 rounded border border-slate-200 hover:bg-slate-100 transition-colors";
        
        if(["applications","requests","permits"].includes(activeTab)) {
            actionTd.innerHTML = `
                <button class="${btnClass}">View</button>
                <button class="${btnClass} text-green-600">Approve</button>
                <button class="${btnClass} text-red-600">Reject</button>`;
        } else if(activeTab === "inventory" || activeTab === "userInventory") {
            actionTd.innerHTML = `
                <button class="${btnClass}">View</button>
                <button class="${btnClass} text-blue-600">Edit</button>`;
        } else if(activeTab === "users") {
            actionTd.innerHTML = `<button class="${btnClass}">Disable</button><button class="${btnClass} text-red-600">Delete</button>`;
        }
        if(activeTab !== "transactions") tr.appendChild(actionTd);
        body.appendChild(tr);
      });
      updateCharts(filtered);
    }

    function initCharts() {
        const ctxLine = $('lineChart').getContext('2d');
        myLineChart = new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: ['Feb 06', 'Feb 07', 'Feb 08', 'Feb 09', 'Feb 10', 'Feb 11', 'Feb 12'],
                datasets: [{
                    label: 'Volume',
                    data: [12, 19, 3, 5, 2, 3, 9],
                    borderColor: '#006400',
                    backgroundColor: 'rgba(0, 100, 0, 0.05)',
                    fill: true,
                    tension: 0.4,
                    borderWidth: 2
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { font: { size: 9 } } }, x: { ticks: { font: { size: 9 } } } } }
        });

        const ctxDoughnut = $('doughnutChart').getContext('2d');
        myDoughnutChart = new Chart(ctxDoughnut, {
            type: 'doughnut',
            data: {
                labels: ['Approved', 'Pending', 'To Review', 'Reject'],
                datasets: [{
                    data: [10, 5, 2, 1],
                    backgroundColor: ['#006400', '#f59e0b', '#3b82f6', '#ef4444'],
                    borderWidth: 0
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, font: { size: 9 } } } } }
        });
    }

    function updateCharts(filteredData) {
        if (!myDoughnutChart) return;
        const counts = {};
        filteredData.forEach(d => {
            const val = d.status || d.category || 'Other';
            counts[val] = (counts[val] || 0) + 1;
        });
        myDoughnutChart.data.labels = Object.keys(counts);
        myDoughnutChart.data.datasets[0].data = Object.values(counts);
        myLineChart.data.datasets[0].label = activeTab.toUpperCase();
        myDoughnutChart.update();
        myLineChart.update();
    }

    function updateKPIs() {
        $("kpi-apps").textContent = DATA.applications.length;
        $("kpi-reqs").textContent = DATA.requests.length;
        $("kpi-permits").textContent = DATA.permits.length;
        $("kpi-inv").textContent = DATA.inventory.length;
        $("kpi-uinv").textContent = DATA.userInventory.length;
        $("kpi-txn").textContent = DATA.transactions.length;
        $("kpi-users").textContent = DATA.users.length;
    }

    document.querySelectorAll(".nav-trigger").forEach(btn => {
      btn.addEventListener("click", (e) => {
        document.querySelectorAll(".nav-trigger").forEach(b => {
            b.classList.remove("active", "border-b-amber-500", "bg-denr-light", "text-denr");
            b.classList.add("border-b-transparent", "text-slate-500");
        });
        
        e.target.classList.add("active", "border-b-amber-500", "bg-denr-light", "text-denr");
        e.target.classList.remove("border-b-transparent", "text-slate-500");
        
        activeTab = e.target.getAttribute("data-tab");
        populateCategories(); 
        renderTable();
      });
    });

    $("searchInput").addEventListener("input", renderTable);
    $("categorySelect").addEventListener("change", renderTable);

    window.onload = () => {
        initCharts();
        populateCategories(); 
        renderTable(); 
        updateKPIs();
    };
  </script>
</body>
</html>