<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DENR | Super Admin Master Console</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gov-blue': '#0038a8', 
                        'gov-red': '#ce1126',  
                        'denr-dark': '#004d00',
                        'denr-green': '#006400',
                    },
                    fontFamily: {
                        'serif': ['Georgia', 'serif'],
                        'sans': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Official Government Visual Identity */
        .gov-strip { background: linear-gradient(to right, #0038a8 50%, #ce1126 50%); height: 4px; width: 100%; position: fixed; top: 0; z-index: 2000; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #004d00; border-radius: 10px; }
        
        /* Navigation & Tabs Styling */
        .nav-trigger.active { border-bottom: 4px solid #0038a8; background-color: #f8fafc; color: #0038a8; font-weight: 900; }
        .dropdown-menu:not(.show) { display: none !important; }
        
        /* Print Handling for Official Reports */
        @media print {
            .no-print { display: none !important; }
            main { margin-left: 0 !important; padding-top: 0 !important; }
            .bg-slate-800 { background-color: white !important; color: black !important; border: 1px solid black; }
            .shadow-md, .shadow-xl { box-shadow: none !important; }
        }
    </style>
</head>
<body class="bg-[#f4f7f6] font-sans text-slate-900 overflow-x-hidden">
    <div class="gov-strip no-print"></div>

    <div class="fixed top-1 w-full z-[1050] no-print">
        {% include 'super-admin/header-superadmin.html' %}
    </div>
    <div class="fixed left-0 h-full z-[1040] no-print">
        {% include 'super-admin/sidenav-superadmin.html' %}
    </div>

    <main class="lg:ml-64 pt-20 pb-10 transition-all duration-300">
        <div class="max-w-[1700px] mx-auto p-4 lg:px-8 space-y-6"> 
            
            <div class="flex flex-col md:flex-row items-center justify-between border-b border-slate-300 pb-4 mb-6">
                <div class="flex items-center gap-4">
                    <img src="{{ url_for('static', filename='images/denr.jpg') }}" class="h-16 w-16" alt="DENR Seal">
                    <div class="text-left border-l-2 border-slate-200 pl-4">
                        <p class="text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em]">Republic of the Philippines</p>
                        <h1 class="font-serif text-2xl font-black text-denr-dark uppercase tracking-tighter">DENR Master Control Console</h1>
                        <p class="text-[11px] font-bold text-gov-blue uppercase tracking-widest mt-1">Super Admin Registry & Intelligence Dashboard</p>
                    </div>
                </div>
                <div class="flex gap-4 items-center no-print">
                    <div class="text-right">
                        <p class="text-[9px] font-black text-slate-400 uppercase">System Status</p>
                        <p class="text-[11px] font-black text-denr-green uppercase tracking-tighter">Secure Connection Active</p>
                    </div>
                    <button onclick="window.print()" class="bg-slate-800 text-white px-5 py-2 text-[10px] font-black uppercase shadow hover:bg-black flex items-center gap-2 transition-all">
                        <i class="fa-solid fa-print"></i> Generate Report
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 no-print">
                <div class="bg-white border border-slate-200 border-t-4 border-t-denr-green p-4 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Applications</p>
                    <h3 class="text-xl font-black" id="kpi-apps">0</h3>
                </div>
                <div class="bg-white border border-slate-200 border-t-4 border-t-gov-blue p-4 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Requests</p>
                    <h3 class="text-xl font-black" id="kpi-reqs">0</h3>
                </div>
                <div class="bg-white border border-slate-200 border-t-4 border-t-amber-500 p-4 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Permits</p>
                    <h3 class="text-xl font-black" id="kpi-permits">0</h3>
                </div>
                <div class="bg-white border border-slate-200 border-t-4 border-t-emerald-600 p-4 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Inventory</p>
                    <h3 class="text-xl font-black" id="kpi-inv">0</h3>
                </div>
                <div class="bg-white border border-slate-200 border-t-4 border-t-indigo-600 p-4 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Assets</p>
                    <h3 class="text-xl font-black" id="kpi-uinv">0</h3>
                </div>
                <div class="bg-white border border-slate-200 border-t-4 border-t-gov-red p-4 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Revenue</p>
                    <h3 class="text-xl font-black" id="kpi-txn">0</h3>
                </div>
                <div class="bg-white border border-slate-200 border-t-4 border-t-slate-800 p-4 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Personnel</p>
                    <h3 class="text-xl font-black" id="kpi-users">0</h3>
                </div>
            </div>

            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 no-print">
                <div class="lg:col-span-2 bg-white border border-slate-200 p-6 shadow-sm">
                    <h4 class="text-[11px] font-black text-denr-dark uppercase mb-4 border-l-4 border-gov-blue pl-3">Nationwide Submission Trends</h4>
                    <div class="h-[250px]"><canvas id="lineChart"></canvas></div>
                </div>
                <div class="bg-white border border-slate-200 p-6 shadow-sm">
                    <h4 class="text-[11px] font-black text-denr-dark uppercase mb-4 border-l-4 border-gov-red pl-3">Regional Compliance Rank</h4>
                    <div class="h-[250px]"><canvas id="barChart"></canvas></div>
                </div>
            </div>

            <div class="bg-white border border-slate-200 shadow-md flex flex-col min-h-[700px]">
                
                <div class="p-6 bg-slate-50 border-b no-print">
                    <div class="flex flex-col lg:flex-row justify-between items-end gap-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 flex-1 w-full">
                            <div class="space-y-1">
                                <label class="text-[10px] font-black text-slate-500 uppercase">Registry Search</label>
                                <input id="searchInput" class="w-full px-4 py-2 text-xs border border-slate-300 outline-none focus:ring-1 focus:ring-gov-blue" placeholder="Filter Registry...">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-black text-slate-500 uppercase">Registry Sector</label>
                                <select id="categorySelect" class="w-full px-4 py-2 text-xs border border-slate-300 bg-white font-bold outline-none uppercase"></select>
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-black text-slate-500 uppercase">Jurisdiction</label>
                                <select id="scopeSelect" class="w-full px-4 py-2 text-xs border border-slate-300 bg-white outline-none">
                                    <option value="all">NATIONAL (All Regions)</option>
                                    <option value="ivb">REGION IV-B</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex gap-2">
                            <button onclick="exportTableToCSV()" class="bg-denr-green text-white px-6 py-2.5 text-[10px] font-black uppercase tracking-widest shadow hover:bg-denr-dark transition-all flex items-center gap-2">
                                <i class="fa-solid fa-file-csv"></i> Export CSV
                            </button>
                        </div>
                    </div>
                </div>

                <nav class="flex bg-slate-100 border-b overflow-x-auto no-print">
                    <button class="nav-trigger active px-8 py-4 text-[11px] font-black uppercase tracking-tight whitespace-nowrap" data-tab="applications">Applications</button>
                    <button class="nav-trigger px-8 py-4 text-[11px] font-black uppercase tracking-tight text-slate-500 hover:text-gov-blue whitespace-nowrap transition-all" data-tab="requests">Service Requests</button>
                    <button class="nav-trigger px-8 py-4 text-[11px] font-black uppercase tracking-tight text-slate-500 hover:text-gov-blue whitespace-nowrap transition-all" data-tab="inventory">Inventory</button>
                    <button class="nav-trigger px-8 py-4 text-[11px] font-black uppercase tracking-tight text-slate-500 hover:text-gov-blue whitespace-nowrap transition-all" data-tab="permits">Licensing</button>
                    <button class="nav-trigger px-8 py-4 text-[11px] font-black uppercase tracking-tight text-slate-500 hover:text-gov-blue whitespace-nowrap transition-all" data-tab="transactions">Revenue/Collections</button>
                    <button class="nav-trigger px-8 py-4 text-[11px] font-black uppercase tracking-tight text-slate-500 hover:text-gov-blue whitespace-nowrap transition-all" data-tab="users">System Accounts</button>
                </nav>

                <div class="overflow-x-auto flex-1">
                    <table id="masterTable" class="w-full text-left">
                        <thead class="bg-slate-50 border-b-2 border-slate-200">
                            <tr id="tableHeadRow" class="text-[10px] uppercase font-black text-slate-600"></tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-slate-100 text-[12px] text-slate-700"></tbody>
                    </table>
                </div>
                
                <div class="p-4 bg-slate-800 flex justify-between items-center text-[10px] font-black text-white uppercase tracking-[0.1em] no-print">
                    <div>Records Found: <span id="resultCount" class="text-amber-400">0</span></div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        Secure Super Admin Registry Session â€¢ 2026
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- COMPLETE SYSTEM DATASET ---
        const CATEGORIES = {
            applications: ["Forestry Management", "Biodiversity", "Lands", "Mining", "Environmental Services"],
            requests: ["Site Inspection", "Administrative Audit", "Clearance", "Certification"],
            inventory: ["Seedlings", "Wildlife Registry", "Seized Materials", "Government Assets"],
            permits: ["Tree Cutting", "Wildlife Trade", "ECC", "PTO", "CITES"],
            transactions: ["Application Fee", "Permit Fee", "Administrative Penalty"],
            users: ["Central Office", "Regional Director", "PENRO Official", "CENRO Personnel"]
        };

        const DATA = {
            applications: [
                { date: "2026-02-13", ref: "DENR-APP-2026-001", entity: "MIMAROPA Dev Corp", sector: "Forestry Management", region: "IV-B", lgu: "Calapan City", status: "PENDING" },
                { date: "2026-02-12", ref: "DENR-APP-2026-002", entity: "Naujan NGO", sector: "Biodiversity", region: "IV-B", lgu: "Naujan", status: "APPROVED" }
            ],
            requests: [{ date: "2026-02-13", ref: "SR-9910-B", entity: "Mindoro Cooperative", sector: "Inspection", region: "IV-B", lgu: "Victoria", status: "FOR REVIEW" }],
            inventory: [{ cat: "Seedlings", desc: "Narra Premium Saplings", qty: 5000, region: "IV-B", lgu: "Baco" }],
            permits: [{ ref: "PMT-CITES-882", entity: "Nature Exporters", sector: "Wildlife Trade", region: "IV-B", lgu: "San Teodoro", status: "ACTIVE" }],
            transactions: [{ ref: "OR-10291-TX", entity: "MIMAROPA Corp", type: "Permit Fee", date: "2026-02-13", region: "IV-B", status: "PAID", amount: 15400 }],
            users: [{ name: "Maria Santos", email: "maria@denr.gov.ph", type: "Regional Director", region: "IV-B", lgu: "Calapan", status: "ACTIVE" }]
        };

        const HEADERS = {
            applications: ["Date", "Registry ID", "Entity Name", "Sector", "Region", "LGU", "Status"],
            requests: ["Date", "Request ID", "Client", "Category", "Region", "LGU", "Status"],
            inventory: ["Category", "Asset Description", "Units on Hand", "Region", "Municipality"],
            permits: ["License No", "Licensee", "Sector", "Region", "LGU", "Status"],
            transactions: ["OR No.", "Payor", "Fee Type", "Date", "Region", "Status", "Amount"],
            users: ["Personnel", "Gov Email", "Designation", "Region", "Assigned LGU", "Account"]
        };

        let activeTab = "applications";
        const $ = (id) => document.getElementById(id);
        let myLineChart, myBarChart;

        // --- CORE SYSTEM LOGIC ---
        function populateCategories() {
            const select = $("categorySelect");
            select.innerHTML = '<option value="all">-- ALL SECTORS --</option>';
            (CATEGORIES[activeTab] || []).forEach(cat => {
                const opt = document.createElement("option"); opt.value = cat; opt.textContent = cat.toUpperCase(); select.appendChild(opt);
            });
        }

        function renderTable() {
            const head = $("tableHeadRow"); const body = $("tableBody");
            const search = $("searchInput").value.toLowerCase();
            const catF = $("categorySelect").value;
            
            head.innerHTML = ""; body.innerHTML = "";
            (HEADERS[activeTab] || []).forEach(t => { const th = document.createElement("th"); th.className="px-6 py-4"; th.textContent = t; head.appendChild(th); });

            const filtered = (DATA[activeTab] || []).filter(r => {
                const mSearch = Object.values(r).join(" ").toLowerCase().includes(search);
                const mCat = catF === "all" || r.sector === catF || r.category === catF || r.cat === catF;
                return mSearch && mCat;
            });

            $("resultCount").textContent = filtered.length;
            filtered.forEach(r => {
                const tr = document.createElement("tr"); tr.className = "border-b hover:bg-slate-50 transition-colors";
                Object.values(r).forEach(v => {
                    const td = document.createElement("td"); td.className = "px-6 py-4 whitespace-nowrap";
                    td.textContent = (typeof v === 'number' && v > 1000) ? v.toLocaleString() : v;
                    tr.appendChild(td);
                });
                body.appendChild(tr);
            });
        }

        function initCharts() {
            // Trend Line
            myLineChart = new Chart($('lineChart'), { 
                type: 'line', 
                data: { labels: ['Feb 07','08','09','10','11','12','13'], datasets: [{ label:'Submissions', data:[450, 620, 580, 890, 720, 950, 1100], borderColor:'#0038a8', fill: true, tension: 0.3 }] },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}}
            });

            // Regional Bar Rank
            myBarChart = new Chart($('barChart'), { 
                type: 'bar', 
                data: { labels: ['NCR','IV-A','IV-B','III','VII'], datasets: [{ data:[92, 85, 95, 78, 88], backgroundColor:['#004d00','#006400','#0038a8','#f59e0b','#ce1126'] }] },
                options: { indexAxis: 'y', responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{max:100}} }
            });
        }

        // --- EXPORT COMMAND ---
        function exportTableToCSV() {
            let csv = [];
            const rows = document.querySelectorAll("#masterTable tr");
            for (let i = 0; i < rows.length; i++) {
                let row = [], cols = rows[i].querySelectorAll("td, th");
                for (let j = 0; j < cols.length; j++) row.push('"' + cols[j].innerText + '"');
                csv.push(row.join(","));
            }
            const csvBlob = new Blob([csv.join("\n")], { type: "text/csv" });
            const url = window.URL.createObjectURL(csvBlob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `DENR_MASTER_REPORT_${activeTab.toUpperCase()}_2026.csv`;
            a.click();
        }

        // --- EVENTS ---
        document.querySelectorAll(".nav-trigger").forEach(btn => {
            btn.addEventListener("click", (e) => {
                document.querySelectorAll(".nav-trigger").forEach(b => b.classList.remove("active"));
                e.target.classList.add("active");
                activeTab = e.target.getAttribute("data-tab");
                populateCategories(); renderTable();
            });
        });

        $("searchInput").addEventListener("input", renderTable);
        $("categorySelect").addEventListener("change", renderTable);

        window.onload = () => { initCharts(); populateCategories(); renderTable(); $("kpi-apps").textContent=DATA.applications.length; $("kpi-reqs").textContent=DATA.requests.length; $("kpi-permits").textContent=DATA.permits.length; $("kpi-inv").textContent=DATA.inventory.length; $("kpi-txn").textContent=DATA.transactions.length; $("kpi-users").textContent=DATA.users.length; };
    </script>
</body>
</html>