<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TLPH | National Dashboard - Service Requests</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --gov-navy: #002e5f;
      --gov-bg: #f1f5f9;
      --gov-border: #cbd5e1;
    }
    
    /* Layout Reset para sa Compact One-View */
    html, body { height: 100vh; overflow: hidden; }
    body { 
      font-family: "Inter", Verdana, sans-serif; 
      background-color: var(--gov-bg); 
      font-size: 0.72rem; 
      color: #1e293b; 
    }
    
    .wrapper { display: flex; height: 100vh; overflow: hidden; }
    main { flex: 1; min-width: 0; padding: 0.5rem 1rem; display: flex; flex-direction: column; overflow: hidden; }

    /* Government Style Components */
    .gov-card { 
      background: #ffffff; 
      border: 1px solid var(--gov-border); 
      border-radius: 2px;
      margin-bottom: 0.5rem;
    }

    /* Side-Border Metric Cards */
    .metric-card { border: none; border-left: 5px solid var(--gov-navy); box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .metric-title { font-size: 0.6rem; letter-spacing: 1px; font-weight: 700; color: #64748b; text-transform: uppercase; }
    .metric-value { font-size: 1.4rem; font-weight: 800; line-height: 1.2; letter-spacing: -0.5px; }

    /* Table Density & Sticky Header */
    .table-responsive { flex-grow: 1; overflow-y: auto; background: white; border: 1px solid var(--gov-border); }
    .table-registry thead th { 
      background: #f8fafc; 
      color: var(--gov-navy); 
      font-weight: 700; 
      text-transform: uppercase; 
      font-size: 0.6rem;
      border-bottom: 2px solid var(--gov-border);
      padding: 0.5rem !important;
      position: sticky; top: 0; z-index: 10;
    }
    .table-registry td { padding: 0.4rem 0.6rem !important; vertical-align: middle; border-bottom: 1px solid #e2e8f0; font-size: 0.7rem; }

    .status-pill {
      font-size: 0.55rem; font-weight: 700; padding: 0.15rem 0.4rem; border-radius: 1px; text-transform: uppercase; border: 1px solid;
    }

    /* Compact Chart container */
    .chart-container { position: relative; height: 125px; width: 100%; }
    
    .form-control-sm, .form-select-sm, .btn-sm { font-size: 0.65rem !important; border-radius: 1px !important; }
  </style>
</head>

<body>

<div class="wrapper">
  <div class="hidden lg:block w-64 bg-slate-900">
    {% include 'national/sidenav-national.html' %}
  </div>

  <main>
    <section class="gov-card p-2 px-3 border-0 border-b bg-white rounded-0 mb-2">
      <div class="row g-2 align-items-center">
        <div class="col-xl-4">
          <h6 class="fw-bold m-0" style="color: var(--gov-navy); letter-spacing: 0.5px;">SERVICE REQUESTS REGISTRY</h6>
          <div class="text-muted text-uppercase" style="font-size: 0.55rem;">Republic of the Philippines • National Management Dashboard</div>
        </div>
        <div class="col-xl-8">
          <div class="row g-1 justify-content-end">
            <div class="col-auto"><input type="date" class="form-control form-control-sm"></div>
            <div class="col-auto">
               <button class="btn btn-outline-secondary btn-sm fw-bold h-full px-3">
                 <span class="material-icons-round fs-6 align-middle">file_download</span> EXPORT
               </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="row g-2 mb-2">
      <div class="col-md-3">
        <div class="gov-card metric-card p-2 px-3">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="metric-title">Total Submissions</div>
              <div class="metric-value" style="color: var(--gov-navy);">4,235</div>
            </div>
            <span class="material-icons-round text-slate-300">summarize</span>
          </div>
          <div class="mt-1 border-t pt-1 text-[10px] text-muted">Month: <b>820</b> requests filed</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="gov-card metric-card p-2 px-3" style="border-left-color: #157347;">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="metric-title">Completed/Resolved</div>
              <div class="metric-value text-success">2,910</div>
            </div>
            <span class="material-icons-round text-success opacity-20">check_circle</span>
          </div>
          <div class="mt-1 border-t pt-1 text-[10px] text-muted"><b>68.7%</b> Success Rate</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="gov-card metric-card p-2 px-3" style="border-left-color: #e67e22;">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="metric-title">For Evaluation</div>
              <div class="metric-value" style="color: #d35400;">612</div>
            </div>
            <span class="material-icons-round text-warning opacity-20">pending_actions</span>
          </div>
          <div class="mt-1 border-t pt-1 text-[10px] text-danger fw-bold">Queue: 12 Days Average</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="gov-card metric-card p-2 px-3" style="border-left-color: #b91c1c;">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="metric-title">Rejected / Cancelled</div>
              <div class="metric-value text-danger">410</div>
            </div>
            <span class="material-icons-round text-danger opacity-20">cancel</span>
          </div>
          <div class="mt-1 border-t pt-1 text-[10px] text-muted"><b>9.6%</b> Invalidation Rate</div>
        </div>
      </div>
    </div>

    <div class="row g-2 flex-grow-1 overflow-hidden">
      <div class="col-lg-3 d-flex flex-column gap-1">
        <div class="gov-card p-2 flex-grow-1">
          <div class="fw-bold text-uppercase mb-2 text-slate-500" style="font-size: 0.55rem;">6-Month Filing Trend</div>
          <div class="chart-container"><canvas id="srTrendChart"></canvas></div>
        </div>
        <div class="gov-card p-2 flex-grow-1">
          <div class="fw-bold text-uppercase mb-2 text-slate-500" style="font-size: 0.55rem;">Requests by Service</div>
          <div class="chart-container"><canvas id="srTypeChart"></canvas></div>
        </div>
        <div class="gov-card p-2 flex-grow-1">
          <div class="fw-bold text-uppercase mb-2 text-slate-500" style="font-size: 0.55rem;">Resolution Mix</div>
          <div class="chart-container"><canvas id="srStatusChart"></canvas></div>
        </div>
      </div>

      <div class="col-lg-9 d-flex flex-column overflow-hidden">
        <div class="gov-card flex-grow-1 d-flex flex-column overflow-hidden m-0">
          
          <div class="p-2 px-3 bg-slate-50 border-b">
            <div class="row g-2 align-items-center">
              <div class="col-md-4">
                <div class="input-group input-group-sm">
                  <span class="input-group-text bg-white border-end-0 text-muted">
                    <span class="material-icons-round fs-6">search</span>
                  </span>
                  <input type="text" id="masterSearch" class="form-control border-start-0 ps-0" placeholder="Search Ref ID or Applicant...">
                </div>
              </div>
              <div class="col-md-3">
                <select id="typeFilter" class="form-select form-select-sm">
                  <option value="ALL">All Service Types</option>
                  <option value="FARM VISIT">Farm Visit</option>
                  <option value="GAP TRAINING">GAP Training</option>
                  <option value="INSPECTION">Inspection</option>
                </select>
              </div>
              <div class="col-md-3">
                <select id="statusFilter" class="form-select form-select-sm">
                  <option value="ALL">All Status</option>
                  <option value="TO REVIEW">To Review</option>
                  <option value="PENDING">Pending</option>
                  <option value="COMPLETED">Completed</option>
                </select>
              </div>
              <div class="col-md-2 text-end">
                <button onclick="clearFilters()" class="btn btn-light btn-sm border fw-bold w-100">RESET</button>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table id="masterTable" class="table table-sm table-hover table-registry mb-0">
              <thead>
                <tr>
                  <th>Date Filed</th>
                  <th>Reference ID</th>
                  <th>Applicant</th>
                  <th>Service Type</th>
                  <th>Location</th>
                  <th>Status</th>
                  <th class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Feb 12, 2026</td>
                  <td class="fw-bold text-primary">SR-2026-000442</td>
                  <td>Rivera, Liza</td>
                  <td class="text-uppercase">Initial farm visit</td>
                  <td>Region VII / Cebu</td>
                  <td><span class="status-pill border-info bg-info bg-opacity-10 text-info">To Review</span></td>
                  <td class="text-center">
                    <div class="btn-group shadow-sm border rounded">
                      <button class="btn btn-sm btn-light p-1" title="View"><span class="material-icons-round fs-6 text-secondary">visibility</span></button>
                      <button class="btn btn-sm btn-light p-1" title="Approve"><span class="material-icons-round fs-6 text-success">check_circle</span></button>
                      <button class="btn btn-sm btn-light p-1" title="Reject"><span class="material-icons-round fs-6 text-danger">cancel</span></button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Feb 11, 2026</td>
                  <td class="fw-bold text-primary">SR-2026-000429</td>
                  <td>Garcia, Noel</td>
                  <td class="text-uppercase">GAP training</td>
                  <td>Region IV-A / San Pablo</td>
                  <td><span class="status-pill border-warning bg-warning bg-opacity-10 text-warning">Pending</span></td>
                  <td class="text-center">
                    <div class="btn-group shadow-sm border rounded">
                      <button class="btn btn-sm btn-light p-1" title="View"><span class="material-icons-round fs-6 text-secondary">visibility</span></button>
                      <button class="btn btn-sm btn-light p-1" title="Approve"><span class="material-icons-round fs-6 text-success">check_circle</span></button>
                      <button class="btn btn-sm btn-light p-1" title="Reject"><span class="material-icons-round fs-6 text-danger">cancel</span></button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="p-1 px-3 bg-white border-top d-flex justify-content-between align-items-center">
            <span id="rowCountLabel" class="text-muted" style="font-size: 0.6rem;">Showing: <b>2 records</b></span>
            <nav>
              <ul class="pagination pagination-sm m-0" style="--bs-pagination-font-size: 0.6rem;">
                <li class="page-item disabled"><a class="page-link" href="#">Prev</a></li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">Next</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>

    <footer class="mt-2 text-center text-muted" style="font-size: 0.55rem;">
      REPUBLIC OF THE PHILIPPINES • NATIONAL SERVICE REGISTRY • CONFIDENTIAL DATA
    </footer>
  </main>
</div>

<script>
  // --- CHART LOGIC ---
  const sharedOpts = {
    responsive: true, maintainAspectRatio: false,
    plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, font: { size: 8 } } } },
    scales: { y: { ticks: { font: { size: 8 } } }, x: { ticks: { font: { size: 8 } } } }
  };

  new Chart(document.getElementById('srTrendChart'), {
    type: 'line',
    data: {
      labels: ['S', 'O', 'N', 'D', 'J', 'F'],
      datasets: [{ label: 'Filed', data: [520, 610, 700, 680, 740, 735], borderColor: '#002e5f', tension: 0.2, fill: true, backgroundColor: 'rgba(0,46,95,0.03)' }]
    },
    options: sharedOpts
  });

  new Chart(document.getElementById('srTypeChart'), {
    type: 'bar',
    data: {
      labels: ['Visit', 'Insp', 'GAP', 'Soil', 'Pest'],
      datasets: [{ label: 'Requests', data: [920, 760, 480, 540, 610], backgroundColor: '#475569' }]
    },
    options: { ...sharedOpts, indexAxis: 'y' }
  });

  new Chart(document.getElementById('srStatusChart'), {
    type: 'doughnut',
    data: {
      labels: ['App', 'Pend', 'Rev', 'Rej'],
      datasets: [{ data: [2910, 303, 612, 410], backgroundColor: ['#157347', '#e67e22', '#002e5f', '#b91c1c'], borderWidth: 0 }]
    },
    options: { ...sharedOpts, cutout: '75%', scales: { x: { display: false }, y: { display: false } } }
  });

  // --- FILTER & SEARCH LOGIC ---
  const searchInput = document.getElementById('masterSearch');
  const typeFilter = document.getElementById('typeFilter');
  const statusFilter = document.getElementById('statusFilter');
  const tableRows = document.querySelectorAll('#masterTable tbody tr');
  const rowCountLabel = document.getElementById('rowCountLabel');

  function filterTable() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedType = typeFilter.value.toUpperCase();
    const selectedStatus = statusFilter.value.toUpperCase();
    let visibleCount = 0;

    tableRows.forEach(row => {
      const refId = row.cells[1].innerText.toLowerCase();
      const applicant = row.cells[2].innerText.toLowerCase();
      const serviceType = row.cells[3].innerText.toUpperCase();
      const status = row.cells[5].innerText.toUpperCase();

      const matchesSearch = refId.includes(searchTerm) || applicant.includes(searchTerm);
      const matchesType = selectedType === 'ALL' || serviceType.includes(selectedType);
      const matchesStatus = selectedStatus === 'ALL' || status.includes(selectedStatus);

      if (matchesSearch && matchesType && matchesStatus) {
        row.style.display = "";
        visibleCount++;
      } else {
        row.style.display = "none";
      }
    });
    
    rowCountLabel.innerHTML = `Showing: <b>${visibleCount} records</b>`;
  }

  function clearFilters() {
    searchInput.value = "";
    typeFilter.value = "ALL";
    statusFilter.value = "ALL";
    filterTable();
  }

  // Event Listeners for real-time update
  searchInput.addEventListener('input', filterTable);
  typeFilter.addEventListener('change', filterTable);
  statusFilter.addEventListener('change', filterTable);
</script>

</body>
</html>