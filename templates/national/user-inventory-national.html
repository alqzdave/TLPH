<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TLPH | National Executive Registry</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root { --gov-navy: #0f172a; --gov-bg: #f1f5f9; }
    html, body { height: 100vh; overflow: hidden; background: var(--gov-bg); }
    body { font-family: "Inter", sans-serif; font-size: 0.72rem; }

    .card { background: #ffffff; border: 1px solid #cbd5e1; border-radius: 4px; }
    .modal-bg { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(2px); }
    
    .custom-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    
    .table-compact th { 
      background: #f8fafc; text-transform: uppercase; font-size: 0.6rem; 
      letter-spacing: 0.05em; color: #64748b; position: sticky; top: 0; z-index: 10; 
      border-bottom: 2px solid #e2e8f0; padding: 0.5rem 0.6rem;
    }
    .table-compact td { padding: 0.4rem 0.6rem !important; border-bottom: 1px solid #f1f5f9; }

    .chart-container { position: relative; height: 125px; width: 100%; }
  </style>
</head>

<body class="text-slate-900">

<div class="flex h-screen overflow-hidden">
  <div class="hidden lg:block w-64 bg-slate-900 h-full shrink-0">
    {% include 'national/sidenav-national.html' %}
  </div>

  <main class="flex-1 flex flex-col p-3 space-y-3 overflow-hidden">
    
    <section class="card p-3 flex justify-between items-center shrink-0">
      <div>
        <h1 class="font-bold text-sm text-slate-800 tracking-tight flex items-center gap-2">
          <span class="material-icons-round text-slate-400">inventory_2</span>
          NATIONAL REGISTRY & INVENTORY SYSTEM
        </h1>
        <p class="text-[10px] text-slate-500 uppercase tracking-widest">Official Executive Dashboard • Feb 14, 2026</p>
      </div>
      <div class="flex gap-2">
        <button onclick="openModal('add')" class="px-3 py-1.5 bg-slate-900 text-white rounded text-[11px] font-bold flex items-center gap-1.5 shadow-lg shadow-slate-200 hover:bg-slate-800 transition-all">
          <span class="material-icons-round text-sm">add</span> ADD NEW RECORD
        </button>
        <button class="px-3 py-1.5 border bg-white rounded text-[11px] font-bold flex items-center gap-1.5 hover:bg-slate-50">
          <span class="material-icons-round text-sm">file_download</span> EXPORT CSV
        </button>
      </div>
    </section>

    <section class="grid grid-cols-4 gap-3 shrink-0">
      <div class="card p-2 px-3 border-l-4 border-l-slate-900">
        <div class="text-[9px] font-bold text-slate-500 uppercase">Total Records</div>
        <div id="kpiTotal" class="text-xl font-black text-slate-900">0</div>
      </div>
      <div class="card p-2 px-3 border-l-4 border-l-blue-500">
        <div class="text-[9px] font-bold text-slate-500 uppercase">Initial Qty Sum</div>
        <div id="kpiInitial" class="text-xl font-black text-blue-600">0</div>
      </div>
      <div class="card p-2 px-3 border-l-4 border-l-emerald-500">
        <div class="text-[9px] font-bold text-slate-500 uppercase">Current Qty Sum</div>
        <div id="kpiCurrent" class="text-xl font-black text-emerald-600">0</div>
      </div>
      <div class="card p-2 px-3 border-l-4 border-l-rose-500">
        <div class="text-[9px] font-bold text-slate-500 uppercase">Critical (Low Stock)</div>
        <div id="kpiLow" class="text-xl font-black text-rose-600">0</div>
      </div>
    </section>

    <div class="flex-1 grid grid-cols-12 gap-3 min-h-0">
      
      <div class="col-span-12 xl:col-span-3 flex flex-col gap-2 overflow-y-auto custom-scroll pr-1">
        <div class="card p-2">
          <p class="text-[9px] font-black text-slate-400 uppercase mb-2">Inventory Mix (Category)</p>
          <div class="chart-container"><canvas id="chartType"></canvas></div>
        </div>
        <div class="card p-2">
          <p class="text-[9px] font-black text-slate-400 uppercase mb-2">Distribution by Region</p>
          <div class="chart-container"><canvas id="chartReg"></canvas></div>
        </div>
        <div class="card p-2">
          <p class="text-[9px] font-black text-slate-400 uppercase mb-2">Top Owners (Stock)</p>
          <div class="chart-container"><canvas id="chartOwner"></canvas></div>
        </div>
      </div>

      <section class="col-span-12 xl:col-span-9 card flex flex-col overflow-hidden">
        <div class="p-2 px-3 bg-slate-50 border-b flex items-center justify-between">
          <div class="flex gap-2">
             <select id="filterReg" onchange="applyFilters()" class="border text-[10px] px-2 py-1 rounded bg-white outline-none">
               <option value="ALL">All Regions (Philippines)</option>
               <option>NCR</option><option>CAR</option><option>Region I</option><option>Region II</option>
               <option>Region III</option><option>Region IV-A</option><option>MIMAROPA</option><option>Region V</option>
               <option>Region VI</option><option>Region VII</option><option>Region VIII</option><option>Region IX</option>
               <option>Region X</option><option>Region XI</option><option>Region XII</option><option>Region XIII</option>
               <option>BARMM</option>
             </select>
             <input id="filterSearch" oninput="applyFilters()" type="text" placeholder="Search Master List..." class="border text-[10px] px-2 py-1 rounded w-56 outline-none">
          </div>
          <span class="text-[10px] text-slate-400 font-bold uppercase" id="rowCount">Showing 0 Records</span>
        </div>

        <div class="flex-1 overflow-auto custom-scroll">
          <table class="min-w-full table-compact" id="mainTable">
            <thead>
              <tr class="text-left">
                <th>Product / Item Description</th>
                <th>Category</th>
                <th>Owner / Applicant</th>
                <th>Init / Curr Qty</th>
                <th>Region (Municipality)</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody id="tbody" class="divide-y divide-slate-100">
              <tr class="hover:bg-slate-50 transition-colors">
                <td class="font-bold">Registered Pesticide 2026-A</td>
                <td>Chemical Inventory</td>
                <td>Dela Cruz, Juan</td>
                <td>100 / <span class="text-blue-600 font-bold">45</span></td>
                <td>NCR (Quezon City)</td>
                <td class="flex justify-center gap-1">
                  <button onclick="viewRow(this)" class="p-1 hover:bg-slate-100 rounded text-slate-400" title="View Details"><span class="material-icons-round text-sm">visibility</span></button>
                  <button onclick="editRow(this)" class="p-1 hover:bg-slate-100 rounded text-slate-400" title="Edit"><span class="material-icons-round text-sm">edit</span></button>
                  <button onclick="removeRow(this)" class="p-1 hover:bg-rose-50 rounded text-rose-400" title="Remove"><span class="material-icons-round text-sm">delete</span></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>

    <footer class="text-[9px] text-center text-slate-400 font-bold uppercase py-1 border-t shrink-0">
      © 2026 REPUBLIC OF THE PHILIPPINES • NATIONAL EXECUTIVE REGISTRY v2.1
    </footer>
  </main>
</div>

<div id="modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-50">
  <div class="bg-white rounded-md w-full max-w-md p-5 shadow-2xl">
    <div class="flex justify-between items-center mb-4 border-b pb-2">
      <h2 id="modalTitle" class="font-bold text-slate-800 uppercase text-xs">Record Form</h2>
      <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><span class="material-icons-round">close</span></button>
    </div>
    <form id="recordForm" class="grid grid-cols-2 gap-3">
      <div class="col-span-2">
        <label class="text-[9px] font-bold text-slate-400 uppercase">Product Name</label>
        <input id="fName" type="text" class="w-full px-2 py-1.5 border rounded text-xs" required />
      </div>
      <div>
        <label class="text-[9px] font-bold text-slate-400 uppercase">Category</label>
        <select id="fCat" class="w-full px-2 py-1.5 border rounded text-xs">
          <option>Chemical Inventory</option><option>Natural Resources</option><option>Protected Area</option><option>Biodiversity Inventory</option>
        </select>
      </div>
      <div>
        <label class="text-[9px] font-bold text-slate-400 uppercase">Owner</label>
        <input id="fOwner" type="text" class="w-full px-2 py-1.5 border rounded text-xs" required />
      </div>
      <div>
        <label class="text-[9px] font-bold text-slate-400 uppercase">Initial Qty</label>
        <input id="fInit" type="number" class="w-full px-2 py-1.5 border rounded text-xs" required />
      </div>
      <div>
        <label class="text-[9px] font-bold text-slate-400 uppercase">Current Qty</label>
        <input id="fCurr" type="number" class="w-full px-2 py-1.5 border rounded text-xs" required />
      </div>
      <div>
        <label class="text-[9px] font-bold text-slate-400 uppercase">Region</label>
        <select id="fReg" onchange="updateMuniDropdown()" class="w-full px-2 py-1.5 border rounded text-xs outline-none" required>
          <option value="" disabled selected>Select Region</option>
          <option>NCR</option><option>CAR</option><option>Region I</option><option>Region II</option>
          <option>Region III</option><option>Region IV-A</option><option>MIMAROPA</option><option>Region V</option>
          <option>Region VI</option><option>Region VII</option><option>Region VIII</option><option>Region IX</option>
          <option>Region X</option><option>Region XI</option><option>Region XII</option><option>Region XIII</option>
          <option>BARMM</option>
        </select>
      </div>
      <div>
        <label class="text-[9px] font-bold text-slate-400 uppercase">Municipality</label>
        <select id="fMuni" class="w-full px-2 py-1.5 border rounded text-xs outline-none" required disabled>
          <option value="">Select Region first</option>
        </select>
      </div>
      <div class="col-span-2 flex justify-end gap-2 mt-4 pt-3 border-t">
        <button type="button" onclick="closeModal()" class="px-4 py-1.5 text-xs font-bold text-slate-500 rounded">CANCEL</button>
        <button type="submit" class="px-5 py-1.5 text-xs font-bold bg-slate-900 text-white rounded">SAVE RECORD</button>
      </div>
    </form>
  </div>
</div>

<div id="viewModal" class="fixed inset-0 hidden items-center justify-center modal-bg z-50">
  <div class="bg-white rounded-md w-full max-w-sm p-5 shadow-2xl">
    <div class="flex justify-between items-center mb-4 border-b pb-2">
      <h2 class="font-bold text-slate-800 uppercase text-[10px] flex items-center gap-1"><span class="material-icons-round text-sm">visibility</span> RECORD SUMMARY</h2>
      <button onclick="closeViewModal()" class="text-slate-400 hover:text-slate-600"><span class="material-icons-round">close</span></button>
    </div>
    <div id="viewDetails" class="space-y-3"></div>
    <div class="mt-6 flex justify-end"><button onclick="closeViewModal()" class="px-4 py-1.5 text-xs font-bold bg-slate-100 rounded">CLOSE</button></div>
  </div>
</div>

<script>
  let charts = {};
  let editingRow = null;

  const muniData = {
    "NCR": ["Quezon City", "Manila", "Makati", "Pasig", "Taguig"],
    "CAR": ["Baguio City", "La Trinidad", "Tabuk"],
    "Region I": ["Laoag", "Vigan", "San Fernando"],
    "Region II": ["Tuguegarao", "Ilagan", "Santiago"],
    "Region III": ["San Fernando", "Angeles", "Tarlac City"],
    "Region IV-A": ["Calamba", "Lucena", "Batangas City", "Antipolo"],
    "MIMAROPA": ["Calapan", "Puerto Princesa", "Mamburao"],
    "Region V": ["Legazpi", "Naga", "Sorsogon"],
    "Region VI": ["Iloilo City", "Bacolod", "Roxas City"],
    "Region VII": ["Cebu City", "Tagbilaran", "Dumaguete"],
    "Region VIII": ["Tacloban", "Ormoc", "Calbayog"],
    "Region IX": ["Zamboanga City", "Dipolog", "Pagadian"],
    "Region X": ["Cagayan de Oro", "Iligan", "Malaybalay"],
    "Region XI": ["Davao City", "Tagum", "Digos"],
    "Region XII": ["General Santos", "Koronadal", "Kidapawan"],
    "Region XIII": ["Butuan", "Surigao City", "Bislig"],
    "BARMM": ["Cotabato City", "Marawi", "Jolo"]
  };

  const chartColors = ['#0f172a', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#14b8a6', '#6366f1', '#475569', '#1e40af', '#065f46', '#92400e', '#b91c1c', '#5b21b6', '#9d174d'];

  function updateMuniDropdown(selectedMuni = "") {
    const reg = document.getElementById('fReg').value;
    const muniSelect = document.getElementById('fMuni');
    muniSelect.innerHTML = "";
    if(muniData[reg]) {
      muniSelect.disabled = false;
      muniData[reg].forEach(m => {
        const opt = document.createElement('option');
        opt.value = m; opt.textContent = m;
        if(m === selectedMuni) opt.selected = true;
        muniSelect.appendChild(opt);
      });
    } else {
      muniSelect.disabled = true;
      muniSelect.innerHTML = '<option value="">Select Region first</option>';
    }
  }

  function openModal(mode) {
    document.getElementById('modal').classList.replace('hidden', 'flex');
    if(mode === 'add') {
      document.getElementById('recordForm').reset();
      document.getElementById('fMuni').disabled = true;
      document.getElementById('modalTitle').innerText = "Add New Registry Entry";
      editingRow = null;
    }
  }

  function closeModal() { document.getElementById('modal').classList.replace('flex', 'hidden'); }

  function viewRow(btn) {
    const tr = btn.closest('tr'); const cells = tr.cells; const qtyArr = cells[3].innerText.split(' / ');
    const data = { "Item": cells[0].innerText, "Category": cells[1].innerText, "Owner": cells[2].innerText, "Stock": cells[3].innerText, "Location": cells[4].innerText };
    document.getElementById('viewDetails').innerHTML = Object.entries(data).map(([k,v])=>`<div><p class="text-[9px] text-slate-400 uppercase font-bold tracking-tighter">${k}</p><p class="text-xs font-semibold text-slate-700">${v}</p></div>`).join('');
    document.getElementById('viewModal').classList.replace('hidden', 'flex');
  }

  function closeViewModal() { document.getElementById('viewModal').classList.replace('flex', 'hidden'); }

  function editRow(btn) {
    editingRow = btn.closest('tr');
    const cells = editingRow.cells;
    document.getElementById('fName').value = cells[0].innerText;
    document.getElementById('fCat').value = cells[1].innerText;
    document.getElementById('fOwner').value = cells[2].innerText;
    const qtyArr = cells[3].innerText.split(' / ');
    document.getElementById('fInit').value = qtyArr[0];
    document.getElementById('fCurr').value = qtyArr[1].trim();
    const locArr = cells[4].innerText.split(' (');
    document.getElementById('fReg').value = locArr[0].trim();
    updateMuniDropdown(locArr[1]?.replace(')', ''));
    document.getElementById('modalTitle').innerText = "Update Registry Record";
    openModal('edit');
  }

  function removeRow(btn) { if(confirm("Permanently remove record?")) { btn.closest('tr').remove(); updateAnalytics(); } }

  document.getElementById('recordForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('fName').value;
    const cat = document.getElementById('fCat').value;
    const owner = document.getElementById('fOwner').value;
    const init = document.getElementById('fInit').value;
    const curr = document.getElementById('fCurr').value;
    const reg = document.getElementById('fReg').value;
    const muni = document.getElementById('fMuni').value;
    const loc = `${reg} (${muni})`;

    if(editingRow) {
      editingRow.cells[0].innerText = name; editingRow.cells[1].innerText = cat;
      editingRow.cells[2].innerText = owner; editingRow.cells[3].innerHTML = `${init} / <span class="text-blue-600 font-bold">${curr}</span>`;
      editingRow.cells[4].innerText = loc;
    } else {
      const tr = document.createElement('tr');
      tr.className = "hover:bg-slate-50 transition-colors";
      tr.innerHTML = `<td class="font-bold">${name}</td><td>${cat}</td><td>${owner}</td>
                      <td>${init} / <span class="text-blue-600 font-bold">${curr}</span></td><td>${loc}</td>
                      <td class="flex justify-center gap-1">
                        <button onclick="viewRow(this)" class="p-1 hover:bg-slate-100 rounded text-slate-400"><span class="material-icons-round text-sm">visibility</span></button>
                        <button onclick="editRow(this)" class="p-1 hover:bg-slate-100 rounded text-slate-400"><span class="material-icons-round text-sm">edit</span></button>
                        <button onclick="removeRow(this)" class="p-1 hover:bg-rose-50 rounded text-rose-400"><span class="material-icons-round text-sm">delete</span></button>
                      </td>`;
      document.getElementById('tbody').prepend(tr);
    }
    closeModal(); updateAnalytics();
  });

  function updateAnalytics() {
    const rows = [...document.querySelectorAll('#tbody tr')].filter(r => r.style.display !== 'none');
    let tInit = 0, tCurr = 0, tLow = 0;
    const cats = {}, regs = {}, owns = {};

    rows.forEach((tr, index) => {
      const cat = tr.cells[1].innerText;
      const reg = tr.cells[4].innerText.split(' (')[0];
      const own = tr.cells[2].innerText;
      const qtyText = tr.cells[3].innerText.split(' / ');
      const init = parseInt(qtyText[0]); const curr = parseInt(qtyText[1]);
      tInit += init; tCurr += curr; if(curr <= 10) tLow++;
      cats[cat] = (cats[cat] || 0) + curr; regs[reg] = (regs[reg] || 0) + curr; owns[own] = (owns[own] || 0) + curr;
    });

    document.getElementById('kpiTotal').innerText = rows.length;
    document.getElementById('kpiInitial').innerText = tInit.toLocaleString();
    document.getElementById('kpiCurrent').innerText = tCurr.toLocaleString();
    document.getElementById('kpiLow').innerText = tLow;
    document.getElementById('rowCount').innerText = `Showing ${rows.length} Total Records`;
    
    renderChart('chartType', 'doughnut', Object.keys(cats), Object.values(cats));
    renderChart('chartReg', 'bar', Object.keys(regs), Object.values(regs));
    const topO = Object.entries(owns).sort((a,b)=>b[1]-a[1]).slice(0,5);
    renderChart('chartOwner', 'bar', topO.map(x=>x[0]), topO.map(x=>x[1]), true);
  }

  function renderChart(id, type, labels, data, horizontal = false) {
    if(charts[id]) charts[id].destroy();
    charts[id] = new Chart(document.getElementById(id), {
      type, data: { labels, datasets: [{ data, backgroundColor: chartColors }] },
      options: { 
        indexAxis: horizontal ? 'y' : 'x',
        responsive: true, maintainAspectRatio: false, 
        plugins: { legend: { display: type === 'doughnut', position: 'right', labels: { boxWidth: 8, font: { size: 8 } } } },
        scales: type === 'bar' ? { y: { beginAtZero: true, ticks: { font: { size: 8 } }, grid: { display: false } }, x: { ticks: { font: { size: 8 } }, grid: { display: false } } } : {}
      }
    });
  }

  function applyFilters() {
    const s = document.getElementById('filterSearch').value.toLowerCase();
    const r = document.getElementById('filterReg').value;
    [...document.querySelectorAll('#tbody tr')].forEach(row => {
      const matchS = row.innerText.toLowerCase().includes(s);
      const matchR = r === 'ALL' || row.cells[4].innerText.includes(r);
      row.style.display = matchS && matchR ? '' : 'none';
    });
    updateAnalytics();
  }

  updateAnalytics();
</script>

</body>
</html>